{% extends "base.html" %}

{% block title %}{{ t('سجل التنفيذ') }} - Non Real Assistant{% endblock %}

{% block page_title %}{{ t('سجل تنفيذ السكريبتات') }}{% endblock %}
{% block page_subtitle %}{{ t('عرض نتائج تشغيل جميع السكريبتات') }}{% endblock %}

{% block page_css %}
<style>
    .execution-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .execution-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .output-box {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 1rem;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        max-height: 300px;
        overflow-y: auto;
        direction: ltr;
        text-align: left;
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    .error-box {
        background: #2d1f1f;
        color: #f48771;
    }
</style>
{% endblock %}

{% block page_actions %}
<select class="form-select" id="status-filter" onchange="filterExecutions()">
    <option value="all">{{ t('جميع الحالات') }}</option>
    <option value="success">{{ t('نجح') }}</option>
    <option value="failed">{{ t('فشل') }}</option>
    <option value="timeout">{{ t('انتهى الوقت') }}</option>
    <option value="running">{{ t('قيد التشغيل') }}</option>
</select>
{% endblock %}

{% block content %}
<!-- Stats -->
<div class="row row-cards mb-3">
    <div class="col-sm-6 col-lg-3">
        <div class="card card-sm">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-auto">
                        <span class="bg-blue text-white avatar">
                            <i class="ti ti-list-details"></i>
                        </span>
                    </div>
                    <div class="col">
                        <div class="font-weight-medium" id="stat-total">0</div>
                        <div class="text-muted">{{ t('إجمالي التنفيذات') }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-sm-6 col-lg-3">
        <div class="card card-sm">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-auto">
                        <span class="bg-green text-white avatar">
                            <i class="ti ti-circle-check"></i>
                        </span>
                    </div>
                    <div class="col">
                        <div class="font-weight-medium" id="stat-success">0</div>
                        <div class="text-muted">{{ t('نجح') }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-sm-6 col-lg-3">
        <div class="card card-sm">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-auto">
                        <span class="bg-red text-white avatar">
                            <i class="ti ti-circle-x"></i>
                        </span>
                    </div>
                    <div class="col">
                        <div class="font-weight-medium" id="stat-failed">0</div>
                        <div class="text-muted">{{ t('فشل') }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-sm-6 col-lg-3">
        <div class="card card-sm">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-auto">
                        <span class="bg-yellow text-white avatar">
                            <i class="ti ti-clock"></i>
                        </span>
                    </div>
                    <div class="col">
                        <div class="font-weight-medium" id="stat-timeout">0</div>
                        <div class="text-muted">{{ t('انتهى الوقت') }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Executions List -->
<div class="row row-cards" id="executions-container">
    <div class="col-12 text-center py-5">
        <div class="spinner-border text-muted" role="status"></div>
        <div class="mt-2">{{ t('جاري التحميل...') }}</div>
    </div>
</div>
{% endblock %}

{% block modals %}
<!-- Execution Details Modal -->
<div class="modal modal-blur fade" id="modal-execution" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-title">{{ t('تفاصيل التنفيذ') }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Content loaded dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" data-bs-dismiss="modal">{{ t('إغلاق') }}</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block page_js %}
<script>
    window.translations = {
        'notifications_enabled': "{{ t('تم تفعيل الإشعارات بنجاح ✓') }}",
        'error_enabling_notifications': "{{ t('حدث خطأ في تفعيل الإشعارات') }}",
        'notifications_enabled_title': "{{ t('الإشعارات مفعّلة') }}",
        'notifications_disabled': "{{ t('الإشعارات مغلقة') }}",
        'click_to_enable_notifications': "{{ t('اضغط لتفعيل الإشعارات') }}",
        'error_loading_log': "{{ t('حدث خطأ في تحميل السجل') }}",
        'no_execution_log': "{{ t('لا يوجد سجل تنفيذ') }}",
        'run_script_to_view': "{{ t('قم بتشغيل سكريبت لعرض النتائج هنا') }}",
        'go_to_scripts': "{{ t('الذهاب للسكريبتات') }}",
        'success_status': "{{ t('نجح') }}",
        'failed_status': "{{ t('فشل') }}",
        'timeout_status': "{{ t('انتهى الوقت') }}",
        'running_status': "{{ t('قيد التشغيل') }}",
        'unknown_script': "{{ t('Unknown Script') }}",
        'view_details': "{{ t('عرض التفاصيل') }}",
        'started': "{{ t('بدأ') }}",
        'error_creating_card': "{{ t('Error creating card for execution') }}",
        'execution_id': "{{ t('معرف التنفيذ:') }}",
        'execution_time': "{{ t('وقت التنفيذ:') }}",
        'status': "{{ t('الحالة') }}",
        'start_time': "{{ t('بداية التنفيذ:') }}",
        'end_time': "{{ t('نهاية التنفيذ:') }}",
        'not_finished_yet': "{{ t('لم ينته بعد') }}",
        'output_stdout': "{{ t('Output (stdout):') }}",
        'error_stderr': "{{ t('Error (stderr):') }}",
        'no_output_or_errors': "{{ t('لا يوجد مخرجات أو أخطاء') }}",
        'now': "{{ t('الآن') }}",
        'since': "{{ t('منذ') }}",
        'second': "{{ t('ثانية') }}",
        'minute': "{{ t('دقيقة') }}",
        'minutes_two': "{{ t('دقيقتين') }}",
        'hour': "{{ t('ساعة') }}",
        'hours_two': "{{ t('ساعتين') }}",
        'day': "{{ t('يوم') }}",
        'days_two': "{{ t('يومين') }}"
    };
</script>
<script src="{{ url_for('static', filename='js/executions.js') }}"></script>
{% endblock %}